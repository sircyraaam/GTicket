# ========================================
# üîê SECURITY: Block access to .ht* files
# ========================================
<FilesMatch "^\.ht">
    Require all denied
</FilesMatch>

# ========================================
# üîÄ URL Rewrite Engine
# ========================================
Options +FollowSymLinks -MultiViews
RewriteEngine On
RewriteBase /

# ========================================
# üîê Force HTTPS (even behind proxies/load balancers)
# ========================================
RewriteCond %{HTTPS} off [OR]
RewriteCond %{HTTP:X-Forwarded-Proto} !https
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [NE,L,R=301]

# ========================================
# üßº Clean URLs: Redirect /foo.php to /foo (external redirect)
# ========================================
RewriteCond %{REQUEST_METHOD} !POST
RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\s([^.]+)\.php [NC]
RewriteRule ^ %1 [R=302,L,NE]

# ========================================
# üõ† Internally rewrite /foo to /foo.php
# ========================================
RewriteCond %{REQUEST_FILENAME}.php -f [NC]
RewriteRule ^ %{REQUEST_URI}.php [L]

# ========================================
# üöß Custom 404 Error Page
# ========================================
ErrorDocument 404 /GTicket/404error.php

# ========================================
# üõ°Ô∏è Security Headers
# ========================================
<IfModule mod_headers.c>
    Header always set Content-Security-Policy "default-src 'self'; object-src 'none'; frame-ancestors 'none';"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set Cross-Origin-Resource-Policy "same-site"
</IfModule>
